<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Retro Canvas WebGL + Windows 98</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
html,body{margin:0;height:100%;overflow:hidden;background:#000}
#gui{position:absolute;top:10px;left:10px;color:#FF8000;font-family:sans-serif;z-index:10}
#gui input,#gui select{width:150px}
canvas{display:block;position:absolute;top:0;left:0;z-index:1}

/* Windows 98 mock styles */
:root{
  --surface:#c0c0c0;--text:#222;--highlight:#fff;--shadow:#808080;
  --frame:#0a0a0a;--blue:#000080;--blue-light:#1084d0;--link-blue:#00f;
  --border-raised:inset -1px -1px var(--frame),inset 1px 1px var(--highlight),
  inset -2px -2px var(--shadow),inset 2px 2px var(--surface);
  --border-sunken:inset -1px -1px var(--highlight),inset 1px 1px var(--frame),
  inset -2px -2px var(--surface),inset 2px 2px var(--shadow);
  --border-window:inset -1px -1px var(--frame),inset 1px 1px var(--surface),
  inset -2px -2px var(--shadow),inset 2px 2px var(--highlight);
}

body{
  font-family:"Pixelated MS Sans Serif",Arial;
  -webkit-font-smoothing:none;font-size:11px;
  background:#008080;overflow:hidden;margin:0;height:100vh;
  display:flex;flex-direction:column;
}
button,input[type=submit],input[type=reset]{
  box-sizing:border-box;border:none;color:var(--text);background:var(--surface);
  box-shadow:var(--border-raised);min-width:75px;min-height:23px;padding:0 12px;
}
button:not(:disabled):active{box-shadow:var(--border-sunken);text-shadow:1px 1px var(--text);}
button:focus{outline:1px dotted var(--frame);outline-offset:-4px;}
.window{
  box-shadow:var(--border-window);background:var(--surface);padding:3px;
  position:absolute;top:100px;left:150px;width:400px;min-width:200px;
  min-height:150px;display:flex;flex-direction:column;z-index:100;
}
.window.maximized{top:0!important;left:0!important;width:100%!important;height:calc(100vh - 30px)!important;}
.title-bar{
  background:linear-gradient(90deg,var(--blue),var(--blue-light));
  padding:3px 2px 3px 3px;display:flex;justify-content:space-between;
  align-items:center;cursor:grab;
}
.title-bar:active{cursor:grabbing;}
.title-bar-text{font-weight:bold;color:#fff;margin-right:24px;}
.title-bar-controls{display:flex;}
.title-bar-controls button{padding:0;min-width:16px;min-height:14px;margin-left:2px;}
.title-bar-controls svg{stroke:var(--frame);stroke-width:1.5;fill:none;}
.window-body{margin:8px;flex-grow:1;background:#fff;box-shadow:var(--border-sunken);padding:10px;overflow:auto;}
.desktop{flex-grow:1;position:relative;padding:10px;}
.desktop-icon{display:flex;flex-direction:column;align-items:center;width:80px;cursor:pointer;text-align:center;}
.desktop-icon img{width:32px;height:32px;margin-bottom:5px;}
.desktop-icon span{color:#fff;background-color:transparent;padding:2px;}
.desktop-icon:focus span{background-color:var(--blue);}
.taskbar{height:30px;background:var(--surface);border-top:1px solid var(--highlight);
  box-shadow:inset 0 1px 0 var(--surface);display:flex;align-items:center;
  padding:2px;z-index:200;}
.start-button{min-width:70px;font-weight:bold;display:flex;align-items:center;gap:5px;padding:0 5px;}
.start-button img{width:20px;height:20px;}
.time-date{margin-left:auto;border:1px solid var(--shadow);
  border-right-color:var(--highlight);border-bottom-color:var(--highlight);
  padding:2px 8px;font-family:'VT323',monospace;font-size:14px;}
.vertical-separator{width:1px;height:100%;background-color:var(--shadow);border-right:1px solid var(--highlight);margin:0 4px;}
.taskbar-btn{min-width:100px;font-weight:bold;display:flex;align-items:center;padding:0 5px;}
.taskbar-btn:not(:disabled):active{box-shadow:var(--border-sunken)!important;}
.start-menu{position:absolute;bottom:30px;left:2px;width:200px;background:var(--surface);
  box-shadow:var(--border-raised);display:none;flex-direction:column;padding:4px 0;z-index:300;}
.start-menu button{all:unset;display:block;width:100%;padding:6px 10px;box-sizing:border-box;
  font-family:"Pixelated MS Sans Serif",Arial;font-size:12px;cursor:default;white-space:nowrap;}
.start-menu button:hover{background:var(--blue-light);color:#fff;}
.submenu{position:absolute;top:0;left:100%;width:200px;background:var(--surface);
  box-shadow:var(--border-raised);display:none;flex-direction:column;padding:4px 0;z-index:400;}
.has-submenu:hover>.submenu{display:flex;}
.has-submenu::after{content:"â–¶";position:absolute;right:6px;}
</style>
</head>
<body>
<div id="gui">
  <table>
    <tr><td>Distortion</td><td><input type="range" id="distortion" min="0" max="100" value="10"></td></tr>
  </table>
</div>
<canvas id="retro-canvas"></canvas>

<!-- Windows 98 Desktop -->
<div class="desktop" id="desktop">
  <div class="desktop-icons">
    <div class="desktop-icon" id="internet-icon" tabindex="0">
      <img src="https://win98icons.alexmeub.com/icons/png/msie1-0.png" alt="Internet Explorer">
      <span>Internet</span>
    </div>
  </div>
  <div class="window" id="my-window" style="display:none;">
    <div class="title-bar">
      <div class="title-bar-text">Internet Explorer</div>
      <div class="title-bar-controls">
        <button aria-label="Minimize" id="minimize-btn"><svg width="10" height="10"><path d="M0 5H10"/></svg></button>
        <button aria-label="Maximize" id="maximize-btn"><svg width="10" height="10"><path d="M0 0H10V10H0ZM1 1V9H9V1Z"/></svg></button>
        <button aria-label="Close" id="close-btn"><svg width="10" height="10"><path d="M0 0L10 10M0 10L10 0"/></svg></button>
      </div>
    </div>
    <div class="window-body">
      <p>Welcome to Windows 98!</p>
      <p>This is a draggable window. Use the buttons on the top right to minimize, maximize, or close.</p>
    </div>
  </div>
</div>
<footer class="taskbar">
  <button class="start-button" id="start-btn">
    <img src="https://win98icons.alexmeub.com/icons/png/windows-0.png" alt="Start Icon">
    <span>Start</span>
  </button>
  <div class="vertical-separator"></div>
  <button class="taskbar-btn" id="taskbar-internet-btn" style="display:none;">Internet</button>
  <div class="time-date" id="time-date"></div>
</footer>
<div class="start-menu" id="start-menu">
  <div class="has-submenu">
    <button>Programs</button>
    <div class="submenu">
      <div class="has-submenu">
        <button>Accessories</button>
        <div class="submenu">
          <button>Games</button><button>Internet Tools</button><button>Multimedia</button>
          <button>System Tools</button><button>Calculator</button><button>Character Map</button>
          <button>Notepad</button><button>Paint</button><button>WordPad</button>
        </div>
      </div>
      <button>StartUp</button><button>MS-DOS Prompt</button><button>Windows Explorer</button>
    </div>
  </div>
  <button>Documents</button><button>Settings</button><button>Find</button>
  <button>Help</button><button>Run ...</button><button>Shut Down ...</button>
</div>

<!-- Windows 98 logic -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const timeDateEl = document.getElementById('time-date');
  function updateTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});
    const dateStr = now.toLocaleDateString('en-US',{month:'2-digit',day:'2-digit',year:'numeric'});
    timeDateEl.textContent = `${timeStr} ${dateStr}`;
  }
  setInterval(updateTime,1000);updateTime();

  const windowEl=document.getElementById('my-window'),
        titleBar=windowEl.querySelector('.title-bar'),
        [minBtn,maxBtn,closeBtn]=[...document.querySelectorAll('.title-bar-controls button')],
        internetIcon=document.getElementById('internet-icon'),
        taskbarInternetBtn=document.getElementById('taskbar-internet-btn');
  let isDragging=false;

  const showWindow=()=>{windowEl.style.display='flex';taskbarInternetBtn.style.display='block';};
  const hideWindow=()=>{windowEl.style.display='none';};
  titleBar.addEventListener('mousedown',()=>{if(windowEl.classList.contains('maximized'))return;isDragging=true;document.addEventListener('mousemove',drag);});
  function drag(e){if(!isDragging)return;windowEl.style.left=`${e.clientX-200}px`;windowEl.style.top=`${e.clientY-10}px`;}
  document.addEventListener('mouseup',()=>{isDragging=false;document.removeEventListener('mousemove',drag);});
  closeBtn.addEventListener('click',()=>{hideWindow();taskbarInternetBtn.style.display='none';});
  minBtn.addEventListener('click',hideWindow);
  internetIcon.addEventListener('dblclick',showWindow);
  taskbarInternetBtn.addEventListener('click',()=>{if(windowEl.style.display==='none'){showWindow();}else{hideWindow();}});
  maxBtn.addEventListener('click',()=>{windowEl.classList.toggle('maximized');});

  const startBtn=document.getElementById('start-btn'),startMenu=document.getElementById('start-menu');
  startBtn.addEventListener('click',()=>startMenu.style.display=startMenu.style.display==='flex'?'none':'flex');
  document.addEventListener('click',e=>{if(!startBtn.contains(e.target)&&!startMenu.contains(e.target))startMenu.style.display='none';});
});
</script>

<!-- WebGL shaders -->
<script id="vs" type="x-shader/x-vertex">
attribute vec2 inPos;varying vec2 vPos;
void main(){vPos=inPos;gl_Position=vec4(inPos,0.0,1.0);}
</script>
<script id="fs" type="x-shader/x-fragment">
precision mediump float;varying vec2 vPos;
uniform sampler2D u_texture;uniform float u_distortion;
void main(){
  vec2 p=vPos;
  vec2 t=p.xy/max(abs(p.x),abs(p.y));
  float len=max(1.0,length(t));
  p*=mix(1.0,mix(1.0,len,max(abs(p.x),abs(p.y))),u_distortion);
  vec2 uv=vec2(p.s,-p.t)*0.5+0.5;
  float clip=step(0.,uv.s)*step(uv.s,1.)*step(0.,uv.t)*step(uv.t,1.);
  gl_FragColor=texture2D(u_texture,uv)*clip;
}
</script>

<!-- WebGL logic -->
<script>
let canvas=document.getElementById("retro-canvas"),
    gl = canvas.getContext("webgl", { preserveDrawingBuffer: true }),
    prog,buf,tex;
function compile(src,type){let s=gl.createShader(type);gl.shaderSource(s,src);gl.compileShader(s);if(!gl.getShaderParameter(s,gl.COMPILE_STATUS))console.error(gl.getShaderInfoLog(s));return s;}
function createProg(vs,fs){let p=gl.createProgram();gl.attachShader(p,vs);gl.attachShader(p,fs);gl.linkProgram(p);if(!gl.getProgramParameter(p,gl.LINK_STATUS))console.error(gl.getProgramInfoLog(p));return p;}

function init(){
  if(!gl)return alert("WebGL not supported");
  let vs=compile(document.getElementById("vs").text,gl.VERTEX_SHADER),
      fs=compile(document.getElementById("fs").text,gl.FRAGMENT_SHADER);
  prog=createProg(vs,fs);
  prog.inPos=gl.getAttribLocation(prog,"inPos");
  prog.uTex=gl.getUniformLocation(prog,"u_texture");
  prog.uDist=gl.getUniformLocation(prog,"u_distortion");

  buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf);
  gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),gl.STATIC_DRAW);
  buf.inx=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buf.inx);
  gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),gl.STATIC_DRAW);

  tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tex);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);

  window.onresize=()=>{canvas.width=innerWidth;canvas.height=innerHeight};window.onresize();
  requestAnimationFrame(render);
}

async function updateTexture(){
  const desktop=document.getElementById("desktop");
  const snapshot=await html2canvas(desktop,{backgroundColor:null});
  gl.bindTexture(gl.TEXTURE_2D,tex);
  gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,snapshot);
}

async function render(){
  let dist=document.getElementById("distortion").value/100;
  await updateTexture();
  gl.viewport(0,0,canvas.width,canvas.height);
  gl.clear(gl.COLOR_BUFFER_BIT);
  gl.useProgram(prog);
  gl.bindBuffer(gl.ARRAY_BUFFER,buf);
  gl.vertexAttribPointer(prog.inPos,2,gl.FLOAT,false,0,0);
  gl.enableVertexAttribArray(prog.inPos);
  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,buf.inx);
  gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,tex);
  gl.uniform1i(prog.uTex,0);gl.uniform1f(prog.uDist,dist);
  gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);
  requestAnimationFrame(render);
}
init();
</script>
</body>
</html>
