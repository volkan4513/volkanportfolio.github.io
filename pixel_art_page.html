<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Responsive Image Effects Grid</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }

    html, body {
      width: 100%;
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1e1e2f;
      color: #fff;
      overflow: hidden;
    }

    .container {
      display: grid;
      width: 100%;
      height: 100%;
      gap: 10px;
      padding: 10px;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      box-sizing: border-box;
    }

    .section {
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      width: 100%;
      height: 100%;
    }

    .header {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 6px #000;
      z-index: 2;
    }

    .slider-container {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      z-index: 2;
    }

    input[type=range] { width: 100%; }

    input[type=file] { display: none; }
  </style>
</head>
<body>

<div class="container">
  <!-- Section 1: Image Upload -->
  <div class="section" id="uploadSection">
    <div class="header">Select or Drag Image</div>
    <input type="file" id="fileInput" accept="image/*">
    <label for="fileInput" style="cursor:pointer; color:#0af; position:absolute; bottom:40px;">Click to select</label>
    <p style="font-size:0.8rem; color:#aaa; position:absolute; bottom:20px;">or drag image here</p>
  </div>

  <!-- Section 2: Scanline -->
  <div class="section" id="scanlineSection">
    <div class="header">Scanline</div>
  </div>

  <!-- Section 3: ASCII -->
  <div class="section" id="asciiSection">
    <div class="header">ASCII</div>
  </div>

  <!-- Section 4: Pixel Art -->
  <div class="section" id="pixelSection">
    <div class="header">Pixel Art</div>
    <div class="slider-container">
      <label>Pixel Colors:
        <input type="range" id="colorSlider" min="4" max="40" value="20">
      </label>
    </div>
  </div>
</div>

<script>
const fileInput = document.getElementById('fileInput');
const uploadSection = document.getElementById('uploadSection');
const scanlineSection = document.getElementById('scanlineSection');
const asciiSection = document.getElementById('asciiSection');
const pixelSection = document.getElementById('pixelSection');
const colorSlider = document.getElementById('colorSlider');

let img = new Image();

// Drag & drop
uploadSection.addEventListener('dragover', e => { e.preventDefault(); uploadSection.style.background = "#333"; });
uploadSection.addEventListener('dragleave', e => { e.preventDefault(); uploadSection.style.background = "#2c2c3f"; });
uploadSection.addEventListener('drop', e => {
  e.preventDefault();
  const file = e.dataTransfer.files[0];
  if(file && file.type.startsWith('image/')) loadImage(file);
});

fileInput.addEventListener('change', e => { const file = e.target.files[0]; if(file) loadImage(file); });

function loadImage(file) {
  const reader = new FileReader();
  reader.onload = ev => { 
    img.src = ev.target.result;
    uploadSection.style.backgroundImage = `url(${ev.target.result})`;
    uploadSection.style.backgroundSize = "cover";
    uploadSection.style.backgroundPosition = "center";
  };
  reader.readAsDataURL(file);
}

img.onload = () => {
  drawScanline();
  drawPixelArt();
  drawASCII();
};

// Helper function to convert canvas to data URL and set as background
function setSectionBackground(canvas, section) {
  section.style.backgroundImage = `url(${canvas.toDataURL()})`;
}

// Scanline effect
function drawScanline() {
  const canvas = document.createElement('canvas');
  const w = scanlineSection.clientWidth;
  const h = scanlineSection.clientHeight;
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');

  const scale = Math.max(w/img.width, h/img.height);
  const sw = img.width * scale;
  const sh = img.height * scale;
  const sx = (w - sw)/2;
  const sy = (h - sh)/2;

  ctx.drawImage(img, sx, sy, sw, sh);

  let imageData = ctx.getImageData(0,0,w,h);
  let data = imageData.data;
  for(let y=0;y<h;y++){
    if(y%2===0){
      for(let x=0;x<w;x++){
        let idx=(y*w+x)*4;
        data[idx]=data[idx+1]=data[idx+2]=0;
      }
    }
  }
  ctx.putImageData(imageData,0,0);
  setSectionBackground(canvas, scanlineSection);
}

// Pixel Art effect
function drawPixelArt() {
  const canvas = document.createElement('canvas');
  const w = pixelSection.clientWidth;
  const h = pixelSection.clientHeight;
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');

  const scale = Math.max(w/img.width, h/img.height);
  const sw = img.width * scale;
  const sh = img.height * scale;
  const sx = (w - sw)/2;
  const sy = (h - sh)/2;

  const blockSize = 3;
  ctx.drawImage(img, sx, sy, sw, sh);
  let imageData = ctx.getImageData(0,0,w,h);
  let data = imageData.data;

  const numColors = parseInt(colorSlider.value);
  const colors = [];
  for(let i=0;i<data.length;i+=4) colors.push([data[i],data[i+1],data[i+2]]);

  function getClosestColor(r,g,b,palette){
    let minDist=Infinity, closest=palette[0];
    for(const c of palette){
      const d=(r-c[0])**2+(g-c[1])**2+(b-c[2])**2;
      if(d<minDist){ minDist=d; closest=c;}
    }
    return closest;
  }

  const palette=[];
  const step=Math.floor(colors.length/numColors);
  for(let i=0;i<colors.length && palette.length<numColors;i+=step) palette.push(colors[i]);

  for(let y=0;y<h;y+=blockSize){
    for(let x=0;x<w;x+=blockSize){
      let r=0,g=0,b=0,count=0;
      for(let by=0;by<blockSize;by++){
        for(let bx=0;bx<blockSize;bx++){
          let px=x+bx, py=y+by;
          if(px>=w || py>=h) continue;
          let idx=(py*w+px)*4;
          r+=data[idx]; g+=data[idx+1]; b+=data[idx+2]; count++;
        }
      }
      r=Math.floor(r/count); g=Math.floor(g/count); b=Math.floor(b/count);
      const [nr,ng,nb] = getClosestColor(r,g,b,palette);
      for(let by=0;by<blockSize;by++){
        for(let bx=0;bx<blockSize;bx++){
          let px=x+bx, py=y+by;
          if(px>=w || py>=h) continue;
          let idx=(py*w+px)*4;
          data[idx]=nr; data[idx+1]=ng; data[idx+2]=nb;
        }
      }
    }
  }
  ctx.putImageData(imageData,0,0);
  setSectionBackground(canvas, pixelSection);
}

// ASCII effect
function drawASCII() {
  const canvas = document.createElement('canvas');
  const w = asciiSection.clientWidth;
  const h = asciiSection.clientHeight;
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');

  const tempCanvas = document.createElement('canvas');
  tempCanvas.width = 100;
  tempCanvas.height = 60;
  const tempCtx = tempCanvas.getContext('2d');

  const scale = Math.max(100/img.width, 60/img.height);
  const sw = img.width * scale;
  const sh = img.height * scale;
  const sx = (100 - sw)/2;
  const sy = (60 - sh)/2;
  tempCtx.drawImage(img, sx, sy, sw, sh);

  let imgData = tempCtx.getImageData(0,0,100,60).data;
  const chars=" .:-=+*#%@";
  ctx.font = "6px monospace";
  ctx.fillStyle = "#aaa";

  for(let y=0;y<60;y++){
    for(let x=0;x<100;x++){
      let idx=(y*100+x)*4;
      let avg=(imgData[idx]+imgData[idx+1]+imgData[idx+2])/3;
      let char = chars[Math.floor((avg/255)*(chars.length-1))];
      ctx.fillText(char, x* (w/100), y*(h/60));
    }
  }
  setSectionBackground(canvas, asciiSection);
}

// Update pixel art on slider change
colorSlider.addEventListener('input', drawPixelArt);

// Redraw on window resize
window.addEventListener('resize', () => {
  if(img.src) { drawScanline(); drawPixelArt(); drawASCII(); }
});
</script>

</body>
</html>
